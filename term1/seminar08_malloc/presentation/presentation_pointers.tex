\documentclass[12pt,pdf,hyperref={unicode}]{beamer}


%\documentclass[10pt]{beamer}

\usetheme[progressbar=frametitle]{metropolis}

\usepackage{booktabs}
\usepackage[scale=2]{ccicons}

\usepackage{pgfplots}

\usepgfplotslibrary{dateplot}

\usepackage{xspace}
\newcommand{\themename}{\textbf{\textsc{metropolis}}\xspace}

\usepackage{multicol}
%\usepackage{lmodern}

% подключаем кириллицу 
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{listings}
%\usepackage{graphicx}
\usepackage{hyperref}

% отключить клавиши навигации
\setbeamertemplate{navigation symbols}{}

% тема оформления
\usetheme{Pittsburgh}

% цветовая схема
\usecolortheme{default}

\definecolor{light-gray}{gray}{0.90}

\title{Семинар №8}   
\subtitle{ФАКИ \the\year}
\author{Бирюков В. А.} 
\date{\today}
% \logo{\includegraphics[height=5mm]{images/logo.png}\vspace{-7pt}}

\begin{document}

\lstset{language=C}

% титульный слайд
\begin{frame}
\titlepage
\end{frame} 

\lstset{
  language=C,                % choose the language of the code
  basicstyle=\linespread{1.1}\ttfamily,
  columns=fixed,
  fontadjust=true,
  basewidth=0.5em,
  keywordstyle=\color{blue}\bfseries,
  commentstyle=\color{gray},
  stringstyle=\ttfamily\color{orange!50!black},
  showstringspaces=false,
  numbersep=5pt,
  numberstyle=\tiny\color{black},
  numberfirstline=true,
  stepnumber=1,                   % the step between two line-numbers.        
  numbersep=10pt,                  % how far the line-numbers are from the code
  backgroundcolor=\color{black!2},  % choose the background color. You must add \usepackage{color}
  showstringspaces=false,         % underline spaces within strings
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=true,         % sets if automatic breaks should only happen at whitespace
  xleftmargin=.2in,
  extendedchars=\true,
  keepspaces = true,
}
\lstset{literate=%
   *{0}{{{\color{red!20!violet}0}}}1
    {1}{{{\color{red!20!violet}1}}}1
    {2}{{{\color{red!20!violet}2}}}1
    {3}{{{\color{red!20!violet}3}}}1
    {4}{{{\color{red!20!violet}4}}}1
    {5}{{{\color{red!20!violet}5}}}1
    {6}{{{\color{red!20!violet}6}}}1
    {7}{{{\color{red!20!violet}7}}}1
    {8}{{{\color{red!20!violet}8}}}1
    {9}{{{\color{red!20!violet}9}}}1
}


\section{Хранение переменных и массивов в памяти}
\begin{frame}[fragile]
\frametitle{Шестнадцатеричная система} 
Система счисления по целочисленному основанию \texttt{16}. \\ 
В качестве цифр этой системы обычно используются цифры от \texttt{0} до \texttt{9} и латинские буквы от \texttt{A} до \texttt{F}.\\
Примеры:\\
\begin{multicols}{2}
\texttt{6 = 0x6} \\
\texttt{12 = 0xc} \\
\texttt{20 = 0x14} \\
\texttt{200 = 0xc8} \\
\texttt{255 = 0xff} \\
\texttt{256 = 0x100} \\
\texttt{1000 = 0x3E8} \\
\texttt{1024 = 0x400} \\
\end{multicols}
\end{frame}

\begin{frame}[fragile]
\frametitle{Шестнадцатеричная система} 
Пример работы шестнадцатиричной системой в языке C:\\
Вместо \texttt{\%d} (decimal) используем \texttt{\%x} (hexadecimal)
\begin{lstlisting}
#include <stdio.h>
int main()
{
	int a = 1000;
	printf("%d\n", a);
	printf("%x\n", a);
}
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\frametitle{Шестнадцатеричная система} 
Для создания шестнадцатиричного числа нужно дописать 
к числу приставку \texttt{0x}
\begin{lstlisting}
#include <stdio.h>
int main()
{
	int a = 0x14;
	printf("%d\n", a);
	printf("%x\n", a);
}
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\frametitle{Хранение переменных типа \texttt{int} в памяти}
Предположим, что мы создали переменную типа \texttt{int} в памяти и присвоили ей число \texttt{7570004}.\\
Как это число будет выглядеть в памяти?\\
Если это число перевести в 16-ричную систему, то получится \texttt{0x738254}.
\begin{center}
\includegraphics[width=0.95\linewidth]{../images/memory/memory_0_int_dec.png}
\end{center}
\end{frame}

\begin{frame}[fragile]
\frametitle{Хранение переменных типа \texttt{int} в памяти} 
\begin{center}
\includegraphics[width=0.95\linewidth]{../images/memory/memory_0_int_hex.png}
\end{center}
\end{frame}

\begin{frame}[fragile]
\frametitle{Порядок байт}
Порядок байт:
\begin{enumerate}
\item Big Endian -- от старшего байта к младшему.
\item Little Endian  -- от младшего байта к старшему. Используется в большинстве вычислительных системах.
\end{enumerate}
\begin{center}
\includegraphics[width=1\linewidth]{../images/memory/memory_1_endianness.png}
\end{center}
В дальнейшем будем предполагать, что используется порядок Little Endian
\end{frame}

\begin{frame}[fragile]
\frametitle{Разные переменные в памяти} 
\begin{center}
\includegraphics[width=1\linewidth]{../images/memory/memory_2_different_types.png}
\end{center}
\end{frame}

\begin{frame}[fragile]
\frametitle{Указатель на переменную типа \texttt{int}}
Каждый ячейка памяти имеет номер (адрес).\\
Указатель -- переменная, которая хранит адреса.
\begin{center}
\includegraphics[width=1\linewidth]{../images/memory/memory_3_pointer_to_int.png}
\end{center}
В 64-х битных система размер указателя равен 64 бит \\(т.е. 8 байт).\\
Обратите внимание, что для указателя тоже используется Little Endian.
\end{frame}

\begin{frame}[fragile]
\frametitle{Указатель на переменную типа \texttt{char}} 
\begin{center}
\includegraphics[width=1\linewidth]{../images/memory/memory_4_pointer_to_char.png}
\end{center}
Код ASCII символа A равен 65 или 0x41. \\
Независимо от размера самой переменной, размер указателя равен 8 байтам.
\end{frame}

\begin{frame}[fragile]
\frametitle{Указатель на переменную типа \texttt{double}} 
\begin{center}
\includegraphics[width=1\linewidth]{../images/memory/memory_5_pointer_to_double.png}
\end{center}
Представление чисел с плавающей точкой в памяти задаётся стандартом \texttt{IEEE 754}.\\
Шестнадцатиричное представление \texttt{3.14159} по этому стандарту: \texttt{0x400921f9f01b866e}.
\end{frame}

\begin{frame}[fragile]
\frametitle{Указатель на элемент массива \texttt{int}-ов} 
Элементы массива лежат в памяти последовательно, без зазоров. 
Порядок байт -- обратный, но только в рамках одного базового типа.
\begin{center}
\includegraphics[width=0.95\linewidth]{../images/memory/memory_6_pointer_to_int_array.png}
\end{center}
\end{frame}

\begin{frame}[fragile]
\frametitle{Указатель на элемент массива \texttt{int}-ов} 
При присваивание указателю или при передаче в функцию 
название массива ведёт себя как указатель на первый 
элемент (т. е. \texttt{a == \&a[0]})
\begin{center}
\includegraphics[width=0.95\linewidth]{../images/memory/memory_6_pointer_to_int_array_by_name.png}
\end{center}
\end{frame}

\begin{frame}[fragile]
\frametitle{Указатель на элемент массива \texttt{char}-ов (строку)} 
Символ \texttt{M} имеет код ASCII равный \texttt{77 = 0x4d}.\\
Остальные символы:\\
\texttt{I} (\texttt{0x49}), \texttt{P} \texttt{(0x50}), \texttt{T}(\texttt{0x54}) \texttt{!}(\texttt{0x21})
\begin{center}
\includegraphics[width=0.95\linewidth]{../images/memory/memory_7_pointer_to_char_array.png}
\end{center}
\end{frame}


\begin{frame}[fragile]
\frametitle{Схематическое изображение указателя} 
Так как постоянно рисовать память и адреса затратно,
то будем использовать схематическое изображение обычных переменных (в виде прямоугольника)
 и указателей (в виде прямоугольничка со стрелочкой)
\begin{center}
\includegraphics[width=0.95\linewidth]{../images/memory/memory_8_schematic.png}
\end{center}
\end{frame}

\begin{frame}[fragile]
\frametitle{Схематическое изображение указателя на элемент массива} 
\begin{center}
\includegraphics[width=0.95\linewidth]{../images/memory/memory_9_schematic_int_array.png}
\end{center}
\end{frame}


\section{Операции с указателями}

\begin{frame}[fragile]
\frametitle{Операции с указателями}
\begin{lstlisting}
int array[5] = {11, 12, 13, 14, 15};
int* p = &array[0];
int* q = &array[3];
\end{lstlisting}
\begin{itemize}
\item Прибавление/вычитание целого числа
\begin{verbatim}
p += 2;
\end{verbatim}
\item Вычитание двух указателей
\begin{verbatim}
int n = q - p;
\end{verbatim}
\item Разыменование
\begin{verbatim}
int x = *p;
\end{verbatim}
\item Квадратные скобки
\begin{verbatim}
int x = p[2];
\end{verbatim}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Приведение указателей} 
\begin{itemize}
\item Приведение типов int и float: \\
\begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue}]
float x = 5.2;
int y = (int)x;       // explicit
int z = x;            // implicit
\end{lstlisting}
\item Верно и для указателей: \\
\begin{lstlisting}[language=C++,basicstyle=\ttfamily,keywordstyle=\color{blue}]
float a;
float* pf = &a;
int* p1 = (int*)pf;   // explicit
int* p2 = pf;         // implicit
\end{lstlisting}
\end{itemize}
\end{frame}





\end{document}
